/*!
 * MockJax - jQuery Plugin to Mock Ajax requests
 *
 * Version:  1.5.0pre
 * Released:
 * Home:   http://github.com/appendto/jquery-mockjax
 * Author:   Jonathan Sharp (http://jdsharp.com)
 * License:  MIT,GPL
 *
 * Copyright (c) 2011 appendTo LLC.
 * Dual licensed under the MIT or GPL licenses.
 * http://appendto.com/open-source-licenses
 */
(function(n){function h(t){var i,u,f;window.DOMParser==undefined&&window.ActiveXObject&&(DOMParser=function(){},DOMParser.prototype.parseFromString=function(n){var t=new ActiveXObject("Microsoft.XMLDOM");return t.async="false",t.loadXML(n),t});try{if(i=(new DOMParser).parseFromString(t,"text/xml"),n.isXMLDoc(i)){if(u=n("parsererror",i),u.length==1)throw"Error: "+n(i).text();}else throw"Unable to parse XML";}catch(r){return f=r.name==undefined?r:r.name+": "+r.message,n(document).trigger("xmlParseError",[f]),undefined}return i}function u(n,t,i){(n.context?jQuery(n.context):jQuery.event).trigger(t,i)}function f(t,i){var r=!1;return typeof i=="string"?n.isFunction(t.test)?t.test(i):t==i:(n.each(t,function(u){return i[u]===undefined?r=!1:(r=!0,typeof i[u]=="object"?f(t[u],i[u]):r=n.isFunction(t[u].test)?t[u].test(i[u]):t[u]==i[u])}),r)}function c(t,i){if(n.isFunction(t))return t(i);if(n.isFunction(t.url.test)){if(!t.url.test(i.url))return null}else{var r=t.url.indexOf("*");if(t.url!==i.url&&r===-1||!new RegExp(t.url.replace(/[-[\]{}()+?.,\\^$|#\s]/g,"\\$&").replace("*",".+")).test(i.url))return null}return t.data&&i.data&&!f(t.data,i.data)?null:t&&t.type&&t.type.toLowerCase()!=i.type.toLowerCase()?null:t}function l(t,i){var r=n.extend({},n.mockjaxSettings,t);r.log&&n.isFunction(r.log)&&r.log("MOCK "+i.type.toUpperCase()+": "+i.url,n.extend({},i))}function a(t,i,u){var f=function(r){return function(){return function(){if(this.status=t.status,this.statusText=t.statusText,this.readyState=4,n.isFunction(t.response)&&t.response(u),i.dataType=="json"&&typeof t.responseText=="object"?this.responseText=JSON.stringify(t.responseText):i.dataType=="xml"?this.responseXML=typeof t.responseXML=="string"?h(t.responseXML):t.responseXML:this.responseText=t.responseText,(typeof t.status=="number"||typeof t.status=="string")&&(this.status=t.status),typeof t.statusText=="string"&&(this.statusText=t.statusText),n.isFunction(this.onreadystatechange)){t.isTimeout&&(this.status=-1);this.onreadystatechange(t.isTimeout?"timeout":undefined)}else t.isTimeout&&(this.status=-1)}.apply(r)}}(this);t.proxy?r({global:!1,url:t.proxy,type:t.proxyType,data:t.data,dataType:i.dataType==="script"?"text/plain":i.dataType,complete:function(n){t.responseXML=n.responseXML;t.responseText=n.responseText;t.status=n.status;t.statusText=n.statusText;this.responseTimer=setTimeout(f,t.responseTime||0)}}):i.async===!1?f():this.responseTimer=setTimeout(f,t.responseTime||50)}function v(t,i,r,u){return t=n.extend({},n.mockjaxSettings,t),typeof t.headers=="undefined"&&(t.headers={}),t.contentType&&(t.headers["content-type"]=t.contentType),{status:t.status,statusText:t.statusText,readyState:1,open:function(){},send:function(){u.fired=!0;a.call(this,t,i,r)},abort:function(){clearTimeout(this.responseTimer)},setRequestHeader:function(n,i){t.headers[n]=i},getResponseHeader:function(n){return t.headers&&t.headers[n]?t.headers[n]:n.toLowerCase()=="last-modified"?t.lastModified||(new Date).toString():n.toLowerCase()=="etag"?t.etag||"":n.toLowerCase()=="content-type"?t.contentType||"text/plain":void 0},getAllResponseHeaders:function(){var i="";return n.each(t.headers,function(n,t){i+=n+": "+t+"\n"}),i}}}function y(n,t,r){var f;if(p(n),n.dataType="json",n.data&&i.test(n.data)||i.test(n.url)){b(n,t);var u=/^(\w+:)?\/\/([^\/?#]+)/.exec(n.url),e=u&&(u[1]&&u[1]!==location.protocol||u[2]!==location.host);if(n.dataType="script",n.type.toUpperCase()==="GET"&&e)return f=w(n,t,r),f?f:!0}return null}function p(n){n.type.toUpperCase()==="GET"?i.test(n.url)||(n.url+=(/\?/.test(n.url)?"&":"?")+(n.jsonp||"callback")+"=?"):n.data&&i.test(n.data)||(n.data=(n.data?n.data+"&":"")+(n.jsonp||"callback")+"=?")}function w(t,i,r){var f=r&&r.context||t,u=null;return i.response&&n.isFunction(i.response)?i.response(r):typeof i.responseText=="object"?n.globalEval("("+JSON.stringify(i.responseText)+")"):n.globalEval("("+i.responseText+")"),e(t,i),o(t,i),jQuery.Deferred&&(u=new jQuery.Deferred,typeof i.responseText=="object"?u.resolve(i.responseText):u.resolve(jQuery.parseJSON(i.responseText))),u}function b(n,t){jsonp=n.jsonpCallback||"jsonp"+s++;n.data&&(n.data=(n.data+"").replace(i,"="+jsonp+"$1"));n.url=n.url.replace(i,"="+jsonp+"$1");window[jsonp]=window[jsonp]||function(i){data=i;e(n,t);o(n,t);window[jsonp]=undefined;try{delete window[jsonp]}catch(r){}head&&head.removeChild(script)}}function e(n,t){n.success&&n.success.call(callbackContext,t.response?t.response.toString():t.responseText||"",status,{});n.global&&u(n,"ajaxSuccess",[{},n])}function o(n){n.complete&&n.complete.call(callbackContext,{},status);n.global&&u("ajaxComplete",[{},n]);n.global&&!--jQuery.active&&jQuery.event.trigger("ajaxStop")}function k(i,u){var s,f,e,o;for(typeof i=="object"?(u=i,i=undefined):u.url=i,f=jQuery.extend(!0,{},jQuery.ajaxSettings,u),o=0;o<t.length;o++)if(t[o]&&(e=c(t[o],f),e))return(l(e,f),f.dataType==="jsonp"&&(s=y(f,e,u)))?s:(e.cache=f.cache,e.timeout=f.timeout,e.global=f.global,function(t,i,u,f){s=r.call(n,n.extend(!0,{},u,{xhr:function(){return v(t,i,u,f)}}))}(e,f,u,t[o]),s);return r.apply(n,[u])}var r=n.ajax,t=[],i=/=\?(&|$)/,s=(new Date).getTime();n.extend({ajax:k});n.mockjaxSettings={log:function(n){window.console&&window.console.log&&window.console.log(n)},status:200,statusText:"OK",responseTime:500,isTimeout:!1,contentType:"text/plain",response:"",responseText:"",responseXML:"",proxy:"",proxyType:"GET",lastModified:null,etag:"",headers:{etag:"IJF@H#@923uf8023hFO@I#H#","content-type":"text/plain"}};n.mockjax=function(n){var i=t.length;return t[i]=n,i};n.mockjaxClear=function(n){arguments.length==1?t[n]=null:t=[]};n.mockjax.handler=function(n){if(arguments.length==1)return t[n]}})(jQuery);